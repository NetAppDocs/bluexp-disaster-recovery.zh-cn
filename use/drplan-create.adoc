---
sidebar: sidebar 
permalink: use/drplan-create.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery, virtual machines, vm 
summary: NetApp BlueXP灾难恢复是一种基于云的灾难恢复服务、可自动执行灾难恢复工作流。添加vCenter站点后、即可创建灾难恢复或复制计划。 
---
= 创建复制计划
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
添加vCenter站点后、即可创建灾难恢复或_Replication pl뮮_。选择源和目标vCenter、选择资源组、然后对应用程序的还原和启动方式进行分组。例如、您可以对与一个应用程序关联的虚拟机(VM)进行分组、也可以对具有类似层的应用程序进行分组。

此类计划有时称为_Blueprints_。

您可以创建复制计划、还可以编辑合规性和测试计划。



== 创建计划

向导将引导您完成以下步骤：

* 选择vCenter Server。
* 选择要复制的VM并分配组。
* 映射源环境中的资源与目标之间的映射关系。
* 确定重复情况、运行子系统托管的脚本、设置启动顺序并选择恢复点目标。
* 查看计划。


在创建复制计划时、您可以在以下配置之一中定义源卷和目标卷之间的SnapMirror关系：

* 1比1
* 扇出架构中的1对多
* 一致性组中的多对一
* 多对多


创建计划时、应遵循以下准则：

* 对计划中的所有VM使用相同的凭据。
* 对计划中的所有VM使用相同的脚本。
* 对计划中的所有VM使用相同的子网、DNS和网关。


.开始之前
如果要在此服务中创建SnapMirror关系、则集群及其SVM对等关系应已在BlueXP灾难恢复之外进行设置。



=== 选择vCenter Server

首先、选择源vCenter、然后选择目标vCenter。

.步骤
. 从BlueXP左侧导航栏中、选择*保护*>*灾难恢复*。
. 从BlueXP  灾难恢复顶部菜单中，选择*Replication Plans (复制计划)*，然后选择*Add*(添加)。或者，如果您刚刚开始使用该服务，请从信息板中选择*添加复制计划*。
+
image:dr-plan-create-name.png["显示添加复制计划"]

. 为复制计划创建一个名称。
. 从源vCenter和目标vCenter列表中选择源vCenter和目标vCenter。
. 选择 * 下一步 * 。




=== 选择要复制的应用程序并分配资源组

下一步是将所需的VM分组到功能资源组中。通过资源组、您可以将一组依赖虚拟机分组为符合您要求的逻辑组。例如、组可能包含延迟启动顺序、可在恢复时运行。

在复制计划中选择应用程序时、您可以查看该计划中每个VM的操作系统。这有助于确定如何将虚拟机分组到一个资源组中。


TIP: 每个资源组可以包含一个或多个VM。VM将根据此处包含的顺序启动。

.步骤
. (可选)在应用程序页面的左侧、按虚拟机的数据存储库筛选虚拟机。您还可以按名称搜索特定虚拟机。
. 在应用程序页面的左侧、选择要保护的VM并将其分配给选定组。
+
选定虚拟机将自动添加到组1、并启动一个新的组2。每次将虚拟机添加到最后一个组时、都会添加另一个组。

+
image:dr-plan-create-apps-vms5.png["显示\"Add Replication Plan  to replication\"页面的屏幕截图"]

. (可选)执行以下任一操作：
+
** 要更改组的名称，请单击组*Edit*image:icon-pencil.png["铅笔图标"]图标。
** 要从组中删除某个VM，请选择该VM旁边的*X*。
** 要将虚拟机移动到其他组、请将其拖放到新组中。


. 如果有多个资源组，请确保这些组的顺序与应执行的操作顺序一致。
+
组中的每个VM都会根据此处的顺序依次启动。

. 选择 * 下一步 * 。




=== 将源资源映射到目标

在资源映射步骤中、指定源环境中的资源应如何映射到目标。创建复制计划时、您可以为计划中的每个VM设置启动延迟和顺序。这样、您就可以设置VM的启动顺序。

.开始之前
如果要在此服务中创建SnapMirror关系、则集群及其SVM对等关系应已在BlueXP灾难恢复之外进行设置。

.步骤
. 在"Resource MAPPING (资源映射)"页面中、要对故障转移和测试操作使用相同的映射、请选中此框。
+
image:dr-plan-resource-mapping2.png["复制计划、资源映射选项卡"]

. 在故障转移映射选项卡中、选择每个资源右侧的向下箭头并映射每个资源。
. *计算资源*：选择*计算资源*旁边的向下箭头。
+
** *源数据中心和目标数据中心*
** *目标集群*
** *目标主机*(可选)：选择集群后、您可以设置此信息。
+

TIP: 如果vCenter配置了Distributed Resource Scheduler (DRS)来管理集群中的多个主机、则无需选择主机。如果选择主机、则BlueXP  灾难恢复会将所有VM置于选定主机上。

** *目标VM文件夹*(可选)：创建一个新的根文件夹以存储选定的VM。


. *虚拟网络*：在故障转移映射选项卡中，选择*虚拟网络*旁边的向下箭头。选择源虚拟LAN和目标区块。
. *Virtual Machines*：在故障转移映射选项卡中，选择*Virtual Machines*旁边的向下箭头。
+
如果对默认设置进行了任何更改、则需要提供凭据。

+
VM的默认值已映射。映射使用的设置与VM在生产环境中使用的设置相同(相同的IP地址、子网掩码和网关)。

+
选择与相应网段的网络映射。区块应已配置、因此请选择适当的区块以映射虚拟机。

+
根据您的选择、此部分可能会显示不同的字段。

+
** *IP地址类型*：重新配置VM配置以满足目标虚拟网络要求。BlueXP  灾难恢复提供两种选项：DHCP或静态IP。对于静态IP、请配置子网掩码、网关和DNS服务器。此外、输入VM的凭据。
+
*** *DHCP*：如果希望VM从DHCP服务器获取网络配置信息，请选择此设置。如果选择此选项、则只需提供虚拟机的凭据即可。
*** *静态IP*：如果要手动指定IP配置信息，请选择此设置。您可以从源VM选择相同或不同的信息。如果选择与源相同的、则无需输入凭据。另一方面、如果您选择使用与源不同的信息、则可以提供凭据、VM的IP地址、子网掩码、DNS和网关信息。应在全局级别或每个VM级别提供VM子操作系统凭据。
+
在将大型环境恢复到较小的目标集群时、或者在无需配置一对一物理VMware基础架构的情况下执行灾难恢复测试时、这一点非常有用。

+
image:dr-plan-create-mapping-vms2.png["显示添加复制计划"]



** *脚本*：您可以将.sh、.bat或.ps1格式的自定义脚本作为故障转移后进程。通过自定义脚本、您可以在故障转移过程之后让BlueXP灾难恢复运行脚本。例如、您可以使用自定义脚本在故障转移完成后恢复所有数据库事务。
** *目标VM前缀和后缀*：在虚拟机详细信息下、您可以选择为VM名称添加前缀和后缀。
** *源VM CPU和RAM*：在虚拟机详细信息下，您可以选择调整VM CPU和RAM参数的大小。
+
image:dr-plan-resource-mapping-vm-boot-order.png["显示添加复制计划"]

** *Boot Order*：您可以在故障转移后修改资源组中所有选定虚拟机的启动顺序。默认情况下、系统会使用在选择资源组期间选择的引导顺序；但是、您可以在此阶段进行更改。这有助于确保优先级为一个的所有虚拟机在后续优先级为VM启动之前都在运行。
+
引导顺序编号仅适用于资源组。如果一个组中有一个"2"、另一个组中有一个"2"、则第一个组中的VM将按其顺序启动、第二个组中的VM将按其顺序启动。

+
*** 顺序启动：为每个VM分配一个唯一编号、以便按分配的顺序启动、例如1、2、3、4、5
*** 同时启动：为所有VM分配相同的数量以同时启动它们、例如1、1、1、1、2、2、3、4、4。


** *Boot Delay*：调整启动操作的延迟(以分钟为单位)。
+

TIP: 要将启动顺序重置为默认值，请选择*将VM设置重置为默认值*，然后选择要更改回默认值的设置。

** *创建应用程序一致的副本*：指示是否创建应用程序一致的Snapshot副本。该服务将使应用程序处于静修状态、然后创建一个快照、以获得一致的应用程序状态。在Windows上运行的Oracle以及在Windows上运行的Linux和SQL Server支持此功能。


. *DRAMORes*：选择*DRAMORes*旁边的向下箭头。根据VM的选择、系统会自动选择数据存储库映射。
+
此部分可能已启用或禁用、具体取决于您的选择。

+
** *RPO *：输入恢复点目标(RPO)以指示要恢复的数据量(以时间为单位)。例如、如果您输入60分钟的RPO、则恢复过程中的数据必须始终不超过60分钟。如果发生灾难、您最多可以丢失60分钟的数据。此外、还可以输入要为所有数据存储库保留的Snapshot副本数。
** *保留数量*：输入要保留的快照数量。
** *源和目标数据存储库*：如果存在多个(扇出) SnapMirror关系、则可以选择要使用的目标。如果卷已建立SnapMirror关系、则会显示相应的源数据存储库和目标数据存储库。如果某个卷没有SnapMirror关系、您现在可以通过选择目标集群、目标SVM并提供卷名称来创建一个。此服务将创建卷和SnapMirror关系。
+

NOTE: 如果要在此服务中创建SnapMirror关系、则集群及其SVM对等关系应已在BlueXP灾难恢复之外进行设置。

** 指定恢复点目标(RPO)后、该服务将根据RPO计划主备份并更新二级目标。
** 如果VM来自同一个卷和同一个SVM、则该服务将执行标准ONTAP快照并更新二级目标。
** 如果VM来自不同的卷和同一个SVM、则该服务会通过包含所有卷来创建一致性组快照并更新二级目标。
** 如果VM来自不同的卷和不同的SVM、则该服务会通过将所有卷包含在相同或不同集群中来执行一致性组开始阶段和提交阶段快照、并更新二级目标。
** 在故障转移期间、您可以选择任何快照。如果您选择最新Snapshot、该服务将创建按需备份、更新目标、并使用该Snapshot进行故障转移。






=== 测试映射

.步骤
. 要为测试环境设置不同的映射，请取消选中该框并选择*Test Mappings *选项卡。
. 像以往一样浏览每个选项卡、但这次是针对测试环境。
+
在测试映射选项卡上、虚拟机和存储库映射处于禁用状态。

+

TIP: 您可以稍后测试整个计划。现在、您要为测试环境设置映射。





=== 确定重复情况

选择是要将数据迁移(一次性移动)到另一个目标还是以SnapMirror频率复制数据。

如果要复制数据、请确定镜像数据的频率。

.步骤
. 在重复页面中，选择*Migrate*或*Copate*。
+
** *迁移*：选择此项可将应用程序移动到目标位置。
** *复制*：在重复复制中、使目标副本与源副本中的更改保持最新。


+
image:dr-plan-create-recurrence.png["显示添加复制计划和重复项的屏幕截图"]

. 选择 * 下一步 * 。




=== 查看复制计划

最后、花几分钟时间查看复制计划。


TIP: 您可以稍后禁用或删除复制计划。

.步骤
. 查看每个选项卡中的信息：计划详细信息、故障转移映射和VM。
. 选择*添加计划*。
+
该计划将添加到计划列表中。





== 编辑计划以测试合规性并确保故障转移测试正常运行

您可能需要设置计划来测试合规性和故障转移测试、以确保这些测试在您需要时能够正常工作。

* *合规性时间影响*：创建复制计划时，服务会默认创建合规性计划。默认合规时间为30分钟。要更改此时间、您可以使用编辑复制计划中的计划。
* *测试故障转移影响*：您可以根据需要或按计划测试故障转移过程。这样、您就可以测试虚拟机向复制计划中指定的目标进行故障转移的情况。
+
测试故障转移会创建FlexClone卷、挂载数据存储库并移动该数据存储库上的工作负载。测试故障转移操作不会影响生产工作负载、测试站点上使用的SnapMirror关系以及必须继续正常运行的受保护工作负载。



根据该计划、故障转移测试将运行、并确保工作负载移动到复制计划指定的目标。

.步骤
. 从BlueXP灾难恢复顶部菜单中、选择*复制计划*。
+
image:dr-plan-list.png["显示复制计划列表的屏幕截图"]

. 选择*操作* image:icon-horizontal-dots.png["水平点操作菜单"] 图标并选择*编辑计划*。
. 输入希望BlueXP灾难恢复检查测试合规性的频率(以分钟为单位)。
. 要检查故障转移测试是否运行正常，请选中*按每月计划运行故障转移*。
+
.. 选择要运行这些测试的日期和时间。
.. 以yyy-mm-dd格式输入要开始测试的日期。
+
image:dr-plan-schedule-edit.png["屏幕截图、显示可在其中编辑计划的位置"]



. 要在故障转移测试完成后清理测试环境，请选中*测试故障转移后自动清理*。
+

NOTE: 此过程会从测试位置注销临时VM、删除已创建的FlexClone卷并卸载临时数据存储库。

. 选择 * 保存 * 。

